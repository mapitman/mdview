name: Build

on:
  push:

jobs:
  build-linux:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Determine version
        id: version
        run: |
          # For manual runs (workflow_dispatch) allow explicit version; otherwise use the ref name
          if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
            VERSION="${{ github.event.inputs.version }}"
          else
            VERSION="${{ github.ref_name }}"
          fi
          # strip any leading v
          VERSION="${VERSION#v}"
          echo "VERSION=${VERSION}" >> $GITHUB_OUTPUT

      - name: Show chosen version
        run: |
          echo "Resolved VERSION=${{ steps.version.outputs.VERSION }}"
      - name: Setup tools
        run: sudo apt-get install -y pandoc
      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'
      - name: Build
        run: VERSION="${{ steps.version.outputs.VERSION }}" make all


